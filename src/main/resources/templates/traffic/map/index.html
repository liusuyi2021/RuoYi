<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <th:block th:include="include :: header('地图')"/>
    <link  th:rel="stylesheet"  th:href="@{/js/map/ol/ol.css}">
    <script th:src="@{/js/map/ol/ol.js}"></script>

    <style type="text/css">
        #map {
            width: 100%;
            height: 100%;
            position: absolute;
            background-image: url(../img/synjones.jpg);
            background-repeat: repeat;
        }
        #mapfloor {
            position: absolute;
            bottom: 10px;
            right: 180px;
            top: auto;
            background: rgba(0, 60, 136, .7);
            margin: 1px;
            padding: 2px;
            border: 1px solid #eeeeee70;
            border-top: none;
            font-size: 10px;
            z-index: 9;
            display: none;
            color: #eee;
            text-align: center;
            min-width: 100px;
            max-width: 100px;
        }
        #meum {
            float: left;
            position: absolute;
            top: 10px;
            left: 50px;
            z-index: 2000;
        }
        .ol-mouse-position {
            position: absolute;
            bottom: 10px;
            right: 10px;
            top: auto;
            background: rgba(0, 60, 136, .7);
            margin: 1px;
            padding: 2px;
            border: 1px solid #eeeeee70;
            z-index: 9;
            border-top: none;
            font-size: 10px;
            display: none;
            color: #eee;
            text-align: center;
            min-width: 150px;
            max-width: 100px;
        }
        .ol-scale-line {
            position: absolute;
            bottom: 10px;
            left: 200px;
            top: auto;
            /* 比例尺背景颜色 */
            background: rgba(0, 60, 136, .7);
        }
        .ol-scale-line-inner {
            /* 比例尺边框样式 */
            border: 1px solid #eeeeee70;
            border-top: none;
            /* 比例尺文字大小 */
            font-size: 10px;
            /* 比例尺文字颜色 */
            color: #eee;
            /* 比例尺宽高为动态计算，若需要固定宽度，将最大最小宽度设置为相同即可 */
            min-width: 100px;
            max-width: 100px;
        }
    </style>
    <title>地图demo</title>
</head>

<body>
<div id="map">
    <div id="mousepos" class="ol-mouse-position"></div>
    <div id="meum">
        <button id="zoom-in">缩小</button>
        <button id="zoom-out">放大</button>
        <button id="panto">平移到【哈尔滨】</button>
        <button id="restore">复位</button>
    </div>
    <div id="mapfloor">11层</div>
</div>
<th:block th:include="include :: footer"/>
<script th:inline="javascript">
    //给8位字符串文件名补0  3.11适用
    function zeroPad(num, len, radix) {
        var str = num.toString(radix || 10);
        while (str.length < len) {
            str = "0" + str;
        }
        return str;
    }
    //给8位字符串文件名补0  6.14.1适用
    function padLeft(str, len) {
        return new Array(len - str.length + 1).join("0") + str;
    }
    // 空间参考
    var projection = ol.proj.get('EPSG:4326');
    // 数据源
    var source = new ol.source.TileImage({
        projection: projection,
        tileUrlFunction: function (tileCoord) {
            /* var x = 'C' + zeroPad(tileCoord[1], 8, 16);
             var y = 'R' + zeroPad(-tileCoord[2] - 1, 8, 16);
             var z = 'L' + zeroPad(tileCoord[0], 2, 10);*/
            var z = tileCoord[0];
            var x = Math.abs(tileCoord[1])
            var y = Math.abs(tileCoord[2]) - 1;
            x = x.toString(16);
            y = y.toString(16);
            z = z.toString();
            x = padLeft(x, 8);
            y = padLeft(y, 8);
            z = padLeft(z, 2);
            x = 'C' + x;
            y = 'R' + y;
            z = 'L' + z;
            return "/map/m/" + z + '/' + y + '/' + x + '.png';//这里可以修改地图路径
        }
    });
    //鹰眼配置
    const overviewMapControl = new ol.control.OverviewMap({
        //className: 'ol-overviewmap ol-custom-overviewmap',
        layers: [
            new ol.layer.Tile(
                {
                    source: new ol.source.OSM()
                   /* source: source,*/
                }),
        ]/*,
        collapseLabel: '\u00BB',
        label: '\u00AB',
        collapsed: false,*/
    });
    //基础图层
    var map = new ol.Map({
        // 设置地图控件，默认的三个控件都不显示
        controls: ol.control.defaults({
            attribution: false,
            rotate: false,
            zoom: true
        }),
        controls: ol.control.defaults().extend([overviewMapControl]),
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM()
            })
        ],
        target: 'map',
        view: new ol.View({
            center: ol.proj.transform(
                [126.630, 45.760], 'EPSG:4326', 'EPSG:3857'),
            zoom: 10,
            //最小缩放等级
            minZoom: 7,
            //最大缩放等级
            maxZoom: 17
        })
    });
    //地图视图初始参数
    var view = map.getView();
    var zoom = view.getZoom();
    var center = view.getCenter();
    var rotation = view.getRotation();
    //实现单机缩小按钮的功能
    $('#zoom-in').click(function () {
        var view = map.getView();
        var zoom = view.getZoom();
        view.setZoom(zoom - 1);
    });
    //实现单机放大按钮的功能
    $('#zoom-out').click(function () {
        var view = map.getView();
        var zoom = view.getZoom();
        view.setZoom(zoom + 1);
    });
    //实现平移小按钮的功能
    const london = ol.proj.fromLonLat([126.622, 45.670]);
    $('#panto').click(function () {
        var view = map.getView();
        view.animate({
            center: london,
            duration: 2000,
        });
    });
    //实现复位小按钮的功能
    $('#restore').click(function () {
        var view = map.getView();
        view.animate({
            center: center,
            duration: 2000,
        });
    });
    //添加比例尺控件
    map.addControl(new ol.control.ScaleLine());
    //添加全屏控件
    map.addControl(new ol.control.FullScreen());
    //鼠标事件
    map.on("pointermove", function (evnt) {

        var lonlat = ol.proj.transform(evnt.coordinate, 'EPSG:3857', 'EPSG:4326');
        $("#mousepos").html(lonlat[0].toFixed(6) + ", " + lonlat[1].toFixed(6)).show();
    });
    //地图移动事件
    map.on("moveend", function (e) {
        var view = map.getView();
        var zoom = view.getZoom();
        $("#mapfloor").html("图层" + Math.trunc(zoom)).show();
    });
</script>
</body>
</html>